<div id="placeholder" style = "width:800px; height:500px"> </div>
<script type="text/javascript" charset="utf-8">

<% deliveries = @all_deliveries  %>
<% dates = deliveries.collect do |d| %>
  <% if d.actual_date.to_i > d.planned_date.to_i %>
    <% d.actual_date.to_i %>
  <% else %>
    <% d.planned_date.to_i %>
  <% end %>
  <% end %>
<% max_date = (dates.max * 1000) %>

<% dates = deliveries.collect do |d| %>
  <% if d.actual_date.to_i < d.planned_date.to_i %>
    <% d.actual_date.to_i %>
  <% else %>
    <% d.planned_date.to_i %>
  <% end %>
  <% end %>
<% dates = dates.reject {|d| d == 0}%>
<% min_date = dates.min * 1000 %>
  
var array = <%=h array_or_string_for_javascript(Delivery.planned_date_count(deliveries)) %>;
var array2 = <%=h array_or_string_for_javascript(Delivery.actual_date_count(deliveries)) %>;

var cumulativeArray =  toMultiDimensionalArray(array, 2);
var cumulativeArray2 =  toMultiDimensionalArray(array2, 2);

var options = {
	series: {
		lines: { show: true },
		points: { show: true }
	},
	

	xaxis: {
		mode: "time",
		timeformat: "%b%y",
		min:1291161600000,
		max:<%= max_date + (1.month.to_i * 1000) %>,
		ticks: 12,
		autoscaleMargin: 0.5	
	},

	yaxis: {
		min: 0,
		max: <%= deliveries.count + 500 %>,
		ticks: 10
	}
};

$(function (){
  $.plot($("#placeholder"), [ { label: "Cumulative Planned Deliveries", data: cumulativeArray  },
                              { label: "Cumulative Actual Deliveries", data: cumulativeArray2  }], options);	
});


</script>

