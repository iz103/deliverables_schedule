<h1>Deliveries for <%= @text %></h1>

<% unless params[:deliverable_id] %>

	<script type="text/javascript" charset="utf-8">

	var array = <%=array_or_string_for_javascript(Delivery.planned_date_count) %>;
	var array2 = <%=array_or_string_for_javascript(Delivery.actual_date_count) %>;
	var cumulativeArray =  toMultiDimensionalArray(array, 2);
	var cumulativeArray2 =  toMultiDimensionalArray(array2, 2);
	var options = {
		series: {
			lines: { show: true },
			points: { show: true }
		},
	
		xaxis: {
			mode: "time",
			timeformat: "%d/%m/%y",
			min:1262304000000,
			max:1333238400000,
			ticks: 14,	
		},
	
		yaxis: {
			min: 0,
			max: 500,
			ticks: 10,
		}
	};

	$(function (){
	  $.plot($("#placeholder"), [ { label: "Planned Deliveries", data: cumulativeArray  },
	                              { label: "Actual Deliveries", data: cumulativeArray2  }  ], options);	
	});

	
	</script>
	
	<div id="placeholder" style = "width:950px; height:500px"> </div>

<% else %>

	<% if @deliveries.empty?%>
	  <p>There are no deliveries for this deliverable</p>
	<% else %>
	  <% if params[:deliverable_id] %>
	    <table id ="ddtable">
	    <tr><th>Status</th><th>Planned Date</th><th>Progress</th></tr>
   
	   <% form_tag complete_deliverable_deliveries_path, :method => :put do %>

	      <% @deliveries.each do |delivery|%>
	  	    <tr><td><%=h delivery.status.name %></td><td><%=h delivery.planned_date.to_date %>
		    </td><td><% if delivery.actual_date? %> 
			           Complete <%= check_box_tag "deliveries_ids[]", delivery.id %>
			         <% else %> 
			           Not Complete <%= check_box_tag "deliveries_ids[]", delivery.id %>
	             <% end %>
             
	             <% end %></td></tr>
	           <%= submit_tag "Complete" %><%= submit_tag "Incomplete" %>
	        <% end %>
	      </table>
	  <% end %>
	<% end %>
<% end %>

<%= if params[:deliverable_id]
	  link_to 'back', deliverable_path(@deliverable)
	end %>
<%= if params[:deliverable_id]
	  link_to 'New delivery', new_deliverable_delivery_path(:deliverable_id => @deliverable)
	end %>